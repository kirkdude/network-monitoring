# Claude Code Notes for This Project

## Container Runtime

**This project uses Podman, NOT Docker.**

Always use:

- `podman-compose` instead of `docker-compose`
- `podman` instead of `docker`

Example commands:

```bash
podman-compose up -d
podman-compose ps
podman-compose logs <service>
podman exec <container> <command>
```

## Project Context

- Router: OpenWrt @ 192.168.1.2
- Mac Mini: **192.168.1.124** (runs monitoring stack)
- Database: InfluxDB 2.7 (**Pure InfluxDB** - no Prometheus)
- Visualization: Grafana
- Collection: Telegraf + custom router daemons
- Data Flow: Router → UDP:8094 → Telegraf → InfluxDB → Grafana

## Architecture

**Pure InfluxDB Stack** - This project was migrated from Prometheus to Pure InfluxDB to fix time-range filtering issues.

**CRITICAL: Do NOT add Prometheus or blackbox_exporter back!**

- All monitoring is done via Telegraf plugins writing to InfluxDB
- Blackbox exporter is NOT needed - Telegraf has ping and DNS query plugins
- All dashboard panels MUST use InfluxDB datasource only

All metrics flow through InfluxDB:

- Router daemons → UDP:8094 → Telegraf → InfluxDB (bandwidth, DNS, connections)
- Telegraf plugins → InfluxDB (ping, DNS timing, host metrics)

## Data Schema - IMPORTANT

**dns_query measurement:**

- `_field` = "domain" (field name)
- `_value` = "www.netflix.com" (domain string)

**ALWAYS filter dns_query with both measurement AND field:**

```flux
|> filter(fn: (r) => r._measurement == "dns_query" and r._field == "domain")
```

**Why:** Without field filter, count() creates schema collision (_value as both string and int)

## Recent Changes

- 2025-12-31: Added streaming diagnostics monitoring
  - Telegraf ping plugin for CDN latency/jitter/packet loss
  - Telegraf DNS query plugin for DNS resolution timing
  - 5 new panels in Streaming Services Monitor dashboard
  - All using Pure InfluxDB (Prometheus/blackbox_exporter removed)
