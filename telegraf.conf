[agent]
  interval = "10s"
  flush_interval = "10s"
  hostname = "network-monitoring"

# UDP Input - Receive DNS events from router
[[inputs.socket_listener]]
  service_address = "udp://:8094"
  data_format = "influx"
  read_buffer_size = "64MB"

# Opportunistic CDN Ping - only pings when streaming devices are active
# Replaces static [[inputs.ping]] - only pings when streaming is detected
[[inputs.execd]]
  command = ["/usr/bin/python3", "/scripts/streaming-ping-orchestrator.py"]
  signal = "SIGTERM"
  restart_delay = "10s"
  data_format = "influx"
  environment = [
    "INFLUXDB_URL=http://influxdb:8086",
    "INFLUXDB_TOKEN=${INFLUXDB_TOKEN}",
    "INFLUXDB_ORG=home",
    "INFLUXDB_BUCKET=network"
  ]

# DNS query timing for streaming services
[[inputs.dns_query]]
  interval = "30s"
  servers = ["192.168.1.2"]
  domains = [
    "www.netflix.com",
    "youtube.com",
    "primevideo.com",
    "disneyplus.com"
  ]
  record_type = "A"
  timeout = 5

# Monitor Mac Mini host resources
[[inputs.cpu]]
  interval = "60s"
  percpu = false
  totalcpu = true

[[inputs.mem]]
  interval = "60s"

[[inputs.disk]]
  interval = "300s"
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]

# Output to InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "JIPR8TZUB2cuAKZH08irGj3EHB2sUrCyYjb1wSwVDjqJd42ja3FbxewoLTgnOZ89ExqZMu2Txv73lCkNgcP9kw=="
  organization = "home"
  bucket = "network"
  timeout = "5s"
  content_encoding = "gzip"
